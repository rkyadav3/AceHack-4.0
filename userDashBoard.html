<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student DAO Dashboard</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f8f9fa;
      padding: 20px;
      margin: 0;
      color: #333;
      transition: background-color 0.5s ease;
      background-image: url('https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.05);
      position: relative;
    }

    .container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 6px;
      height: 100%;
      background: linear-gradient(to bottom, #3f51b5, #2196f3);
    }

    header {
      background: linear-gradient(135deg, #3f51b5, #2196f3);
      color: white;
      padding: 25px;
      text-align: center;
    }

    .user-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: #f9f9f9;
      border-bottom: 1px solid #eee;
    }

    .nav-tabs {
      display: flex;
      background: #f1f1f1;
      border-bottom: 1px solid #ddd;
    }

    .nav-tab {
      padding: 15px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .nav-tab:hover {
      background: #e9e9e9;
      color: #3f51b5;
    }

    .nav-tab.active {
      background: white;
      border-bottom: 3px solid #3f51b5;
      font-weight: bold;
      color: #3f51b5;
    }

    .tab-content {
      padding: 20px;
    }

    .tab-pane {
      display: none;
    }

    .tab-pane.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 25px;
      margin-bottom: 25px;
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.4s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    .credits-display {
      font-size: 28px;
      font-weight: bold;
      color: #3f51b5;
      text-align: center;
      padding: 20px;
    }

    .proposal-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .proposal-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }

    .proposal-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #3f51b5;
    }

    .proposal-description {
      color: #666;
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .proposal-status {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .vote-buttons {
      display: flex;
      gap: 10px;
    }

    button {
      background-color: #3f51b5;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    button:hover {
      background-color: #303f9f;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    button.vote-against {
      background-color: #f44336;
    }

    button.vote-against:hover {
      background-color: #d32f2f;
    }

    .nft-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }

    .nft-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      background: white;
    }

    .nft-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .nft-image {
      width: 100%;
      height: 150px;
      background: linear-gradient(45deg, #3f51b5, #2196f3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .nft-info {
      padding: 15px;
    }

    .nft-info h4 {
      color: #3f51b5;
      margin-top: 0;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    .error {
      color: #f44336;
      margin-top: 10px;
      padding: 10px;
      background: #ffebee;
      border-radius: 5px;
    }

    .text-center {
      text-align: center;
    }

    h3 {
      color: #3f51b5;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Student DAO Dashboard</h1>
    </header>

    <div class="user-info">
      <div>
        <span id="userName">Welcome, Student</span>
      </div>
      <div>
        <button id="connectWalletBtn">Connect Wallet</button>
      </div>
    </div>

    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="credits">Credits</div>
      <div class="nav-tab" data-tab="governance">Governance</div>
      <div class="nav-tab" data-tab="certificates">Certificates & NFTs</div>
      <div class="nav-tab" data-tab="tokens">Tokens</div>
    </div>

    <div class="tab-content">
      <!-- Credits Tab -->
      <div class="tab-pane active" id="credits-tab">
        <div class="card">
          <h3>Your Credit Score</h3>
          <div class="credits-display" id="userCredits">
            <div class="loading">Connect your wallet to view your credits</div>
          </div>
          <p class="text-center">Credits represent your participation and achievements in the DAO</p>
        </div>

        <div class="card">
          <h3>Credit History</h3>
          <div id="creditHistory">
            <div class="loading">Connect your wallet to view your credit history</div>
          </div>
        </div>
      </div>

      <!-- Governance Tab -->
      <div class="tab-pane" id="governance-tab">
        <div class="card">
          <h3>Active Proposals</h3>
          <div id="activeProposals">
            <div class="loading">Loading active proposals...</div>
          </div>
        </div>

        <div class="card">
          <h3>Your Voting Power</h3>
          <div class="credits-display" id="votingPower">
            <div class="loading">Connect your wallet to view your voting power</div>
          </div>
          <p class="text-center">Your voting power is based on your credit score</p>
        </div>

        <div class="card">
          <h3>Past Votes</h3>
          <div id="pastVotes">
            <div class="loading">Connect your wallet to view your past votes</div>
          </div>
        </div>
      </div>

      <!-- Certificates & NFTs Tab -->
      <div class="tab-pane" id="certificates-tab">
        <div class="card">
          <h3>Your Certificates & NFTs</h3>
          <div class="nft-grid" id="userNFTs">
            <div class="loading">Connect your wallet to view your certificates and NFTs</div>
          </div>
        </div>
      </div>

      <!-- Tokens Tab -->
      <div class="tab-pane" id="tokens-tab">
        <div class="card">
          <h3>Your Tokens</h3>
          <div class="credits-display" id="userTokens">
            <div class="loading">Connect your wallet to view your tokens</div>
          </div>
          <p class="text-center">Tokens earned from your participation in the DAO</p>
        </div>

        <div class="card">
          <h3>Token Transactions</h3>
          <div id="tokenTransactions">
            <div class="loading">Connect your wallet to view your token transactions</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
  <script>
    // Contract details
    const CREDITS_CONTRACT_ADDRESS = "0x93b2c685acd611f0886e6655834a55fd10db70e4";
    const GOVERNANCE_CONTRACT_ADDRESS = "0x0759bD84C032630eC7a848443DFd89416063fA30";
    
    const CREDITS_ABI = [
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "address",
            "name": "studentWallet",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "string",
            "name": "name",
            "type": "string"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "credits",
            "type": "uint256"
          }
        ],
        "name": "CreditsMinted",
        "type": "event"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "studentWallet",
            "type": "address"
          }
        ],
        "name": "getCredits",
        "outputs": [
          {
            "internalType": "string",
            "name": "name",
            "type": "string"
          },
          {
            "internalType": "uint256",
            "name": "credits",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    // Global variables
    let web3;
    let currentAccount = null;
    let creditsContract;
    let governanceContract;

    // Initialize the application
    async function init() {
      setupTabNavigation();
      await connectWallet();
    }

    // Setup tab navigation
    function setupTabNavigation() {
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs and panes
          document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
          
          // Add active class to clicked tab
          tab.classList.add('active');
          
          // Show corresponding tab content
          const tabName = tab.getAttribute('data-tab');
          document.getElementById(`${tabName}-tab`).classList.add('active');
        });
      });
    }

    // Connect to MetaMask wallet
    async function connectWallet() {
      if (window.ethereum) {
        try {
          web3 = new Web3(window.ethereum);
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          currentAccount = accounts[0];
          
          // Initialize contracts
          creditsContract = new web3.eth.Contract(CREDITS_ABI, CREDITS_CONTRACT_ADDRESS);
          
          // Update UI
          document.getElementById('connectWalletBtn').textContent = `${currentAccount.substring(0, 6)}...${currentAccount.substring(38)}`;
          
          // Load user data
          await loadUserData();
          
          // Setup event listeners for account changes
          window.ethereum.on('accountsChanged', handleAccountsChanged);
        } catch (error) {
          console.error("User denied account access", error);
        }
      } else {
        console.log('Please install MetaMask!');
        alert('Please install MetaMask to use this application');
      }
    }

    // Handle account changes
    function handleAccountsChanged(accounts) {
      if (accounts.length === 0) {
        console.log('Please connect to MetaMask.');
        currentAccount = null;
        document.getElementById('connectWalletBtn').textContent = 'Connect Wallet';
      } else if (accounts[0] !== currentAccount) {
        currentAccount = accounts[0];
        document.getElementById('connectWalletBtn').textContent = `${currentAccount.substring(0, 6)}...${currentAccount.substring(38)}`;
        loadUserData();
      }
    }

    // Load user data
    async function loadUserData() {
      if (!currentAccount) return;
      
      try {
        // Load credits
        await loadUserCredits();
        
        // Load governance data
        await loadGovernanceData();
        
        // Load NFTs and certificates
        loadUserNFTs();
        
        // Load tokens
        loadUserTokens();
      } catch (error) {
        console.error("Error loading user data:", error);
      }
    }

    // Load user credits
    async function loadUserCredits() {
      try {
        const result = await creditsContract.methods.getCredits(currentAccount).call();
        const userName = result.name;
        const credits = result.credits;
        
        document.getElementById('userName').textContent = `Welcome, ${userName}`;
        document.getElementById('userCredits').innerHTML = `
          <div>${credits} Credits</div>
        `;
        
        // Also update voting power
        document.getElementById('votingPower').innerHTML = `
          <div>${credits} Votes</div>
        `;
        
        // Mock credit history
        document.getElementById('creditHistory').innerHTML = `
          <div class="proposal-card">
            <div class="proposal-title">Course Completion: Blockchain Basics</div>
            <div class="proposal-description">Date: ${new Date().toLocaleDateString()}</div>
            <div class="proposal-status">Credits earned: +20</div>
          </div>
          <div class="proposal-card">
            <div class="proposal-title">Active Participation in DAO</div>
            <div class="proposal-description">Date: ${new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toLocaleDateString()}</div>
            <div class="proposal-status">Credits earned: +15</div>
          </div>
        `;
      } catch (error) {
        console.error("Error loading user credits:", error);
        document.getElementById('userCredits').innerHTML = `
          <div class="error">Error loading credits: ${error.message}</div>
        `;
      }
    }

    // Load governance data
    async function loadGovernanceData() {
      // Mock active proposals
      document.getElementById('activeProposals').innerHTML = `
        <div class="proposal-card">
          <div class="proposal-title">Add New Course: Advanced Smart Contracts</div>
          <div class="proposal-description">Proposal to add a new course on advanced smart contract development</div>
          <div class="proposal-status">
            <div>Status: Active (Ends in 2 days)</div>
            <div class="vote-buttons">
              <button onclick="voteOnProposal(1, true)">Vote For</button>
              <button class="vote-against" onclick="voteOnProposal(1, false)">Vote Against</button>
            </div>
          </div>
        </div>
        <div class="proposal-card">
          <div class="proposal-title">Increase Credit Rewards for Project Submissions</div>
          <div class="proposal-description">Proposal to increase the credit rewards for successful project submissions</div>
          <div class="proposal-status">
            <div>Status: Active (Ends in 5 days)</div>
            <div class="vote-buttons">
              <button onclick="voteOnProposal(2, true)">Vote For</button>
              <button class="vote-against" onclick="voteOnProposal(2, false)">Vote Against</button>
            </div>
          </div>
        </div>
      `;
      
      // Mock past votes
      document.getElementById('pastVotes').innerHTML = `
        <div class="proposal-card">
          <div class="proposal-title">Add Weekly Blockchain Workshops</div>
          <div class="proposal-description">You voted: For</div>
          <div class="proposal-status">Result: Passed (75% in favor)</div>
        </div>
        <div class="proposal-card">
          <div class="proposal-title">Change Grading System</div>
          <div class="proposal-description">You voted: Against</div>
          <div class="proposal-status">Result: Failed (40% in favor)</div>
        </div>
      `;
    }

    // Load user NFTs and certificates
    function loadUserNFTs() {
      // Mock NFTs and certificates
      document.getElementById('userNFTs').innerHTML = `
        <div class="nft-card">
          <div class="nft-image">Certificate #1</div>
          <div class="nft-info">
            <h4>Blockchain Basics</h4>
            <p>Completed on ${new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}</p>
          </div>
        </div>
        <div class="nft-card">
          <div class="nft-image">Certificate #2</div>
          <div class="nft-info">
            <h4>Smart Contract Development</h4>
            <p>Completed on ${new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toLocaleDateString()}</p>
          </div>
        </div>
        <div class="nft-card">
          <div class="nft-image">Achievement NFT</div>
          <div class="nft-info">
            <h4>Top Contributor</h4>
            <p>Awarded for active participation</p>
          </div>
        </div>
      `;
    }

    // Load user tokens
    function loadUserTokens() {
      // Mock tokens
      document.getElementById('userTokens').innerHTML = `
        <div>250 SDAO Tokens</div>
      `;
      
      // Mock token transactions
      document.getElementById('tokenTransactions').innerHTML = `
        <div class="proposal-card">
          <div class="proposal-title">Tokens Earned</div>
          <div class="proposal-description">Date: ${new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toLocaleDateString()}</div>
          <div class="proposal-status">Amount: +50 SDAO</div>
        </div>
        <div class="proposal-card">
          <div class="proposal-title">Tokens Earned</div>
          <div class="proposal-description">Date: ${new Date(Date.now() - 20 * 24 * 60 * 60 * 1000).toLocaleDateString()}</div>
          <div class="proposal-status">Amount: +200 SDAO</div>
        </div>
      `;
    }

    // Vote on a proposal
    function voteOnProposal(proposalId, voteInFavor) {
      alert(`You voted ${voteInFavor ? 'for' : 'against'} proposal #${proposalId}`);
      // In a real application, this would call the governance contract
    }

    // Event listeners
    document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);

    // Initialize the application when the page loads
    window.addEventListener('load', init);
  </script>
</body>
</html>
